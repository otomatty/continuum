name: PR Check

on:
  pull_request:
    branches:
      - main
      - develop

jobs:
  check-pr-rules:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR rules
        run: |
          BASE_BRANCH="${{ github.base_ref }}"
          HEAD_BRANCH="${{ github.head_ref }}"
          
          echo "Base branch: $BASE_BRANCH"
          echo "Head branch: $HEAD_BRANCH"
          
          # mainブランチへのPRはdevelopブランチまたはhotfixブランチからのみ許可
          if [ "$BASE_BRANCH" = "main" ]; then
            if [ "$HEAD_BRANCH" != "develop" ] && [[ ! "$HEAD_BRANCH" =~ ^hotfix/ ]]; then
              echo "❌ Error: PRs to main branch must be from develop branch or hotfix/* branch"
              echo "Current head branch: $HEAD_BRANCH"
              echo "Please create a PR from develop branch or hotfix/* branch to main instead."
              exit 1
            fi
            if [ "$HEAD_BRANCH" = "develop" ]; then
              echo "✅ PR to main is from develop branch"
            elif [[ "$HEAD_BRANCH" =~ ^hotfix/ ]]; then
              echo "✅ PR to main is from hotfix branch: $HEAD_BRANCH"
            fi
          fi
          
          # developブランチへのPRは作業ブランチからのみ許可（mainは不可）
          if [ "$BASE_BRANCH" = "develop" ]; then
            if [ "$HEAD_BRANCH" = "main" ]; then
              echo "❌ Error: Cannot create PR from main to develop"
              echo "Please create a feature/bugfix branch from develop instead."
              exit 1
            fi
            echo "✅ PR to develop is from a work branch"
          fi
          
          # main/developブランチへの直接pushをチェック（念のため）
          if [ "$HEAD_BRANCH" = "main" ] || [ "$HEAD_BRANCH" = "develop" ]; then
            echo "⚠️  Warning: PR is from $HEAD_BRANCH branch"
            echo "Work should be done in feature/bugfix/hotfix branches"
          fi

