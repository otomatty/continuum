# Continuum 実装計画書: セットアップフェーズ

## 1. 現状分析

### 1.1 既存のセットアップ状況

プロジェクトは基本的なLeptos + Axumのプロジェクト構造が既に構築されています。

**完了している項目:**
- ✅ モノレポ構成（Cargo workspace）
  - `app/`: 共有ロジック（SSR/Hydrate両対応）
  - `frontend/`: WASMフロントエンド
  - `server/`: Axumバックエンド
- ✅ Leptos + Axum統合設定
- ✅ 基本的なルーティング構造
- ✅ サンプルホームページ
- ✅ cargo-leptos設定
- ✅ end2endテスト環境（Playwright）

**不足している項目:**
- ❌ GitHub API連携（GraphQL）
- ❌ GitHub OAuth認証
- ❌ Cloudflare Workers/Pagesデプロイ設定
- ❌ データモデル定義
- ❌ 主要機能実装（ダッシュボード、ポートフォリオ、知見共有）

### 1.2 技術スタック確認

| コンポーネント | 現状 | 目標 |
|:---|:---|:---|
| **バックエンド** | Axum (ローカル) | Axum on Cloudflare Workers |
| **フロントエンド** | Leptos (SSR) | Leptos on Cloudflare Pages |
| **認証** | 未実装 | GitHub OAuth |
| **データソース** | 未実装 | GitHub GraphQL API |
| **キャッシュ** | 未実装 | Cloudflare KV |

## 2. セットアップ計画

### 2.1 Phase 1: 開発環境の整備（優先度: 高）

**目標:** ローカル開発環境でGitHub API連携と認証を実装

**詳細ドキュメント:**
- [GitHub GraphQL API クライアント実装](./phase1-github-api-client/README.md)
- [GitHub OAuth認証実装](./phase1-github-oauth/README.md)
- [環境変数管理とセットアップ](./phase1-environment-setup/README.md)

**タスク:**
1. **GitHub GraphQL API クライアント実装**
   - `app/src/github/` ディレクトリ作成
   - GraphQLクエリ定義（リポジトリ、コントリビューション、ユーザー情報）
   - APIクライアントモジュール作成

2. **GitHub OAuth認証実装**
   - OAuthフロー実装（`server/src/auth/`）
   - セッション管理（Cookie/Token）
   - 認証ミドルウェア作成

3. **環境変数管理**
   - `.env.example` 作成
   - GitHub OAuth App設定手順のドキュメント化

**依存関係追加:**
```toml
# GitHub API用
reqwest = { version = "0.12", features = ["json"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# OAuth用
oauth2 = "4.5"
cookie = "0.21"
```

### 2.2 Phase 2: データモデルと基本機能（優先度: 高）

**目標:** コアデータモデルとAPIエンドポイントの実装

**詳細ドキュメント:**
- [データモデル定義](./phase2-data-models/README.md)
- [APIエンドポイント実装](./phase2-api-endpoints/README.md)
- [キャッシュ戦略実装](./phase2-caching-strategy/README.md)

**タスク:**
1. **データモデル定義**
   - `app/src/models/` ディレクトリ作成
   - GitHub APIレスポンスの型定義
   - ドメインモデル（User, Repository, Contribution等）

2. **APIエンドポイント実装**
   - `/api/organization` - 組織情報取得
   - `/api/repositories` - リポジトリ一覧
   - `/api/users/:username` - ユーザー情報・コントリビューション
   - `/api/dashboard` - ダッシュボードデータ

3. **キャッシュ戦略**
   - Cloudflare KV互換のローカルキャッシュ実装
   - キャッシュキー設計

### 2.3 Phase 3: Cloudflareデプロイ設定（優先度: 中）

**目標:** Cloudflare Workers/Pagesへのデプロイ環境構築

**詳細ドキュメント:**
- [Cloudflare Workers設定](./phase3-cloudflare-workers/README.md)
- [Cloudflare Pages設定](./phase3-cloudflare-pages/README.md)
- [CI/CD設定](./phase3-cicd/README.md)

**タスク:**
1. **Cloudflare Workers設定**
   - `wrangler.toml` 設定
   - Workers用ビルド設定
   - KV名前空間設定

2. **Cloudflare Pages設定**
   - Pages用ビルド設定
   - 環境変数設定

3. **CI/CD設定**
   - GitHub Actions workflow作成
   - 自動デプロイ設定

**注意点:**
- LeptosのSSRをCloudflare Workersで動作させるための設定調整が必要
- WASMビルドの最適化設定

### 2.4 Phase 4: フロントエンド実装（優先度: 中）

**目標:** 主要UIコンポーネントの実装

**詳細ドキュメント:**
- [レイアウトコンポーネント実装](./phase4-layout-components/README.md)
- [ダッシュボードページ実装](./phase4-dashboard-page/README.md)
- [ポートフォリオページ実装](./phase4-portfolio-page/README.md)

**タスク:**
1. **レイアウトコンポーネント**
   - ヘッダー/ナビゲーション
   - 認証状態の表示

2. **ダッシュボードページ**
   - 組織サマリー表示
   - アクティビティタイムライン
   - リポジトリ一覧

3. **ポートフォリオページ**
   - ユーザープロフィール表示
   - コントリビューショングラフ
   - リポジトリ別フィルタ

## 3. 実装順序

```
Phase 1: 開発環境整備
  ↓
Phase 2: データモデルと基本機能
  ↓
Phase 3: Cloudflareデプロイ設定（並行可能）
  ↓
Phase 4: フロントエンド実装
```

## 4. 技術的な課題と対応

### 4.1 Leptos SSR on Cloudflare Workers

**課題:** LeptosのSSRをCloudflare Workersで動作させる

**対応:**
- `leptos_axum`の代わりにCloudflare Workers用のアダプターが必要な可能性
- 必要に応じてカスタムアダプター実装を検討

### 4.2 GitHub API Rate Limit

**課題:** GitHub APIのレート制限（認証済み: 5,000 req/hour）

**対応:**
- Cloudflare KVによる積極的なキャッシング
- バッチ処理による効率的なデータ取得
- レート制限監視とエラーハンドリング

### 4.3 リアルタイム更新

**課題:** リアルタイムアクティビティタイムラインの実装

**対応:**
- 初期実装はポーリング方式
- 将来的にGitHub Webhooks連携を検討

## 5. 次のステップ

1. **GitHub OAuth App作成**
   - GitHub Settings > Developer settings > OAuth Apps
   - Callback URL設定: `http://localhost:3000/auth/callback`

2. **環境変数設定**
   ```bash
   GITHUB_CLIENT_ID=your_client_id
   GITHUB_CLIENT_SECRET=your_client_secret
   GITHUB_ORG_NAME=your_org_name
   ```

3. **Phase 1実装開始**
   - GitHub GraphQL APIクライアント実装
   - OAuth認証フロー実装

## 関連ドキュメント

- PRD: `PRD.md`
- Issue: （未作成）
- Research: （未作成）

